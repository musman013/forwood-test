{"_index":"2000000001.1000000001","_type":"_doc","_id":"2000000001.0443429762.2000000001.TipoDefinition.PTWCopy","_version":3,"_score":1,"_source":{"tipo_field_groups":[{"_ARRAY_META":{"_HASH":"2129469345"},"tipo_group_name":"parent","tipo_fields":[{"field_type_labels":"Steps","short_display":true,"mobile_width":"100","hidden_hyperlink":true,"disable_expansion":true,"_ARRAY_META":{"_HASH":"8181595068"},"tablet_width":"100","display_name":"Task","false_alternate_label_str":"No","true_alternate_label_str":"Yes","field_name":"task","desktop_width":"100","sequence":1,"hide_header":true,"relationship_type":"embed_reference","tipo_array":false,"do_not_nest_data":true,"show_question_no":true,"hidden_label":true,"field_type":"FieldGroup.Steps","show_in_tab":false}]},{"_ARRAY_META":{"_HASH":"4145166915"},"tipo_group_name":"Step","tipo_fields":[{"field_type_labels":"Task","short_display":true,"hidden_hyperlink":true,"disable_expansion":true,"_ARRAY_META":{"_HASH":"2867913128"},"display_name":"Task","false_alternate_label_str":"No","true_alternate_label_str":"Yes","field_name":"task","sequence":1,"relationship_type":"embed_reference","show_question_no":true,"field_type":"Tipo.Task"}]},{"_ARRAY_META":{"_HASH":"6397576240"},"tipo_group_name":"Task","tipo_fields":[{"field_type_labels":"Text","short_display":true,"hidden_hyperlink":true,"disable_expansion":true,"_ARRAY_META":{"_HASH":"9371192070"},"display_name":"Step","false_alternate_label_str":"No","true_alternate_label_str":"Yes","field_name":"step","sequence":1,"relationship_type":"reference","show_question_no":true,"field_type":"string"},{"allowed_values":["Pre-start","CCV","Hazard ID"],"field_type_labels":"Text","short_display":true,"hidden_hyperlink":true,"disable_expansion":true,"_ARRAY_META":{"_HASH":"5433877334"},"display_name":"Tool Category","false_alternate_label_str":"No","true_alternate_label_str":"Yes","mandatory":true,"field_name":"tool_category","sequence":2,"list_display":true,"dd_field":true,"relationship_type":"reference","tipo_array":true,"show_question_no":true,"field_type":"string"},{"field_type_labels":"Safety Master Data","short_display":true,"hidden_hyperlink":true,"disable_expansion":true,"_ARRAY_META":{"_HASH":"6871027700"},"select_key_field":"tipo_id","select_label_field_labels":"Name","display_name":"Tool","false_alternate_label_str":"No","true_alternate_label_str":"Yes","mandatory":true,"field_name":"tool","visibility_expression":"$tipo_root.work_type","select_label_field":"name","sequence":3,"list_display":true,"relationship_type":"reference","select_key_field_labels":"Safety Master Data ID","tipo_array":true,"show_question_no":true,"relationship_filter":"work_type:($tipo_root.work_type_filter)","field_type":"Tipo.SafetyMasterData"},{"field_type_labels":"TipoFIDUser","short_display":true,"hidden_hyperlink":true,"disable_expansion":true,"_ARRAY_META":{"_HASH":"8464158756"},"select_key_field":"username","select_label_field_labels":"Username","display_name":"Assignee","false_alternate_label_str":"No","true_alternate_label_str":"Yes","mandatory":true,"field_name":"assignee","select_label_field":"username","sequence":4,"list_display":false,"relationship_type":"reference","select_key_field_labels":"Username","show_question_no":true,"field_type":"Tipo.TipoFIDUser"},{"field_type_labels":"TipoFIDUser","short_display":true,"hidden_hyperlink":true,"disable_expansion":true,"_ARRAY_META":{"_HASH":"7086008088"},"select_key_field":"username","select_label_field_labels":"Username","display_name":"Participants","false_alternate_label_str":"No","true_alternate_label_str":"Yes","mandatory":false,"field_name":"participants","select_label_field":"username","sequence":5,"list_display":true,"relationship_type":"reference","select_key_field_labels":"Username","tipo_array":true,"show_question_no":true,"field_type":"Tipo.TipoFIDUser"},{"field_type_labels":"Task","short_display":true,"mobile_width":"100","hidden_hyperlink":true,"disable_expansion":true,"_ARRAY_META":{"_HASH":"2104353441"},"tablet_width":"100","display_name":"Verifications","false_alternate_label_str":"No","true_alternate_label_str":"Yes","field_name":"verifications","desktop_width":"100","sequence":6,"relationship_type":"embed_reference","show_question_no":true,"field_type":"Tipo.Task"}]},{"_ARRAY_META":{"_HASH":"9149165992"},"tipo_group_name":"Steps","tipo_fields":[{"field_type_labels":"Step","short_display":true,"hidden_hyperlink":true,"disable_expansion":true,"_ARRAY_META":{"_HASH":"3572965622"},"display_name":"Steps Included","false_alternate_label_str":"No","true_alternate_label_str":"Yes","field_name":"steps_included","sequence":1,"relationship_type":"reference","tipo_array":true,"show_question_no":true,"field_type":"FieldGroup.Step"}]},{"_ARRAY_META":{"_HASH":"9960306727"},"tipo_group_name":"PermitDetails","tipo_fields":[{"field_type_labels":"Text","short_display":true,"hidden_hyperlink":true,"disable_expansion":true,"_ARRAY_META":{"_HASH":"0133111632"},"default_value":"Approval Requested","display_name":"Status","false_alternate_label_str":"No","true_alternate_label_str":"Yes","field_name":"status_ptw","multiple_choice":true,"element_style":"{'padding-right': '32px'}","sequence":1,"list_display":true,"relationship_type":"reference","read_only":true,"allowed_values_with_colour":[{"colour":"#FF6633","_ARRAY_META":{"_HASH":"8321249786"},"value":"Rejected"},{"colour":"#4DB3FF","_ARRAY_META":{"_HASH":"8326563616"},"value":"Approved"},{"colour":"#E6B333","_ARRAY_META":{"_HASH":"8333966264"},"value":"Approval Requested"}],"hide_in_create":true,"show_question_no":true,"field_type":"string"},{"field_type_labels":"Text","short_display":true,"hidden_hyperlink":true,"disable_expansion":true,"_ARRAY_META":{"_HASH":"5028442271"},"display_name":"Permit Title","false_alternate_label_str":"No","true_alternate_label_str":"Yes","field_name":"permit_title","sequence":2,"list_display":true,"relationship_type":"reference","show_question_no":true,"field_type":"string"},{"field_type_labels":"Work Type","short_display":true,"hidden_hyperlink":true,"disable_expansion":true,"_ARRAY_META":{"_HASH":"7983808603"},"select_key_field":"tipo_id","select_label_field_labels":"Name","display_name":"Work Type","false_alternate_label_str":"No","true_alternate_label_str":"Yes","field_name":"work_type","select_label_field":"name","sequence":2,"list_display":true,"relationship_type":"reference","select_key_field_labels":"Work Type ID","read_only":true,"tipo_array":true,"show_question_no":true,"field_type":"Tipo.WorkType"},{"field_type_labels":"Text","short_display":true,"hidden_hyperlink":true,"disable_expansion":true,"_ARRAY_META":{"_HASH":"8844966188"},"display_name":"work_type_filter","false_alternate_label_str":"No","true_alternate_label_str":"Yes","field_name":"work_type_filter","hidden_":true,"sequence":4,"relationship_type":"reference","show_question_no":true,"field_type":"string"},{"field_type_labels":"Text","short_display":true,"hidden_hyperlink":true,"disable_expansion":true,"_ARRAY_META":{"_HASH":"8221205505"},"display_name":"work_plan_id","false_alternate_label_str":"No","true_alternate_label_str":"Yes","field_name":"work_plan_id","hidden_":true,"sequence":5,"relationship_type":"reference","show_question_no":true,"field_type":"string"}]}],"tipo_event_js":[{"event_name":"OnView (data_handle)","_ARRAY_META":{"_HASH":"1331077816"},"javascript_code":"data_handle.tipo.work_type_filter = data_handle.tipo.work_type.join(' OR ');"},{"event_name":"OnSave (data_handle)","_ARRAY_META":{"_HASH":"5855305231"},"javascript_code":"if(data_handle.mode === 'create'){\n    data_handle.tipo.status_ptw = 'Approval Requested';\n    tipoHandle.getTipo('WorkPlanning',data_handle.tipo.work_plan_id).then((response)=>{\n        response.permit_title = data_handle.tipo.permit_title;\n        response.status = 'PTW Initiated'\n        tipoHandle.updateTipo('WorkPlanning',data_handle.tipo.work_plan_id,response)\n    })\n   \n\nconst domain = window.localStorage.getItem('server_url') ? window.localStorage.getItem('server_url') : window.location.origin +'/';\nconst PTW_LINK = domain +'#/tipo/PTW/'+ data_handle.tipo.tipo_id;\nconst APP_LINK = domain +'#/login';\nlet filter = `(jobRoleCategory.keyword:(Manager) AND (roles.keyword:(!SiteAdmin)))`;\ntipoHandle.getTipos('TipoFIDUser', { tipo_filter: filter }).then((res) => {\n    const users = res.count > 0 ? res.map(t => t.email) : [];\n    let subject = 'A new PTW has been created';\n    let body = `<div><b style=\"font-size: 22px;\">Permit to work Details: </b> <br><br><br>\n                Permit to Work ID: ${data_handle.tipo.tipo_id} <br>\n                Permit Title: ${data_handle.tipo.permit_title} <br> \n                Permit to work Status: ${data_handle.tipo.status_ptw} <br>\n                Description: : A new PTW is created, Request that you take an investigation and update it. <br><br>\n                You can view the PTW details here <a href=\"${PTW_LINK}\" target=\"_blank\" rel=\"noopener noreferrer\" data-auth=\"NotApplicable\" data-linkindex=\"5\" >here</a> <br><br><br>\n                <i>Kind Regards, <br>\n                Forwood Safety Team</i>\n                </div>`;\n    tipoHandle.sendEmail('satest@forwoodsafety.com', subject, body);\n            //tipoHandle.sendEmail(users.toString(), subject, body);\n\n    })\n}"}],"created_dt":1683434217592,"tipo_list":{"default_page_size":10,"desktop_grid":"true","enable_pagination":true,"allow_search":true},"application_owner_account":"2000000001","tipo_fields":[{"hidden_":true,"sequence":-1,"field_type_labels":"Text","_ARRAY_META":{"_HASH":"9753159359"},"display_name":"Permit to work ID","field_type":"string","field_name":"tipo_id"},{"field_type_labels":"Action","hide_in_edit":true,"short_display":true,"hidden_hyperlink":true,"disable_expansion":true,"_ARRAY_META":{"_HASH":"2828029132"},"display_name":"Appove","false_alternate_label_str":"No","true_alternate_label_str":"Yes","action_settings_":{"javascript_code":"console.log(\"approve\",data_handle);\ndata_handle.tipo.status_ptw = 'Approved';\ntipoHandle.updateTipo(data_handle.tipo_name,data_handle.tipo.tipo_id,data_handle.tipo).then((response)=> {\n    tipoHandle.showMessage('PTW Approved');\n    const domain = window.localStorage.getItem('server_url') ? window.localStorage.getItem('server_url') : window.location.origin +'/';\n    const PTW_LINK = domain +'#/tipo/PTW/'+ response.data.tipo_id;\n    let user = response.data.created_by;\n    let subject = 'A PTW has been Approved.';\n    let body = `<div><b style=\"font-size: 22px;\">Permit to work Details: </b> <br><br>\n                Permit to Work ID: ${response.data.tipo_id} <br>\n                Permit Title: ${response.data.permit_title} <br> \n                Permit to work Status: ${response.data.status_ptw} <br>\n                Description: A PTW is Approved, please conduct a pre-start safety meeting to \n                discuss the work to be done, the hazards involved, and the controls in place. <br><br>\n                You can view the Work plan Details <a href=\"${PTW_LINK}\" target=\"_blank\" rel=\"noopener noreferrer\" data-auth=\"NotApplicable\" data-linkindex=\"5\" >here</a> <br><br><br>\n                <i>Kind Regards, <br>\n                Forwood Safety Team</i>\n                </div>`\n    tipoHandle.sendEmail(user, subject, body);\n    \n    tipoHandle.getTipo('WorkPlanning',data_handle.tipo.work_plan_id,{}).then((res)=>{\n        console.log(\"res\",res);\n        res.status = 'PTW Created';\n        res.task = response.data;\n        tipoHandle.updateTipo('WorkPlanning',res.tipo_id,res).then((result)=> {\n                tipoHandle.toTipo('view','WorkPlanning',result.data.tipo_id);\n        });\n    });\n});\nreturn true;"},"field_name":"appove_ptw","desktop_width":"30","element_style":"{'margin':'10px'}","visibility_expression":"$tipo.status_ptw === 'Approval Requested' && ($tipo_handle.user_meta.role === 'Manager' || $tipo_handle.user_meta.role === 'TipoUser')","sequence":1,"value_class":"existingPTW btnStandard","relationship_type":"reference","hide_in_create":true,"show_question_no":true,"element_style_labels":"Margin-10px","hidden_label":true,"field_type":"action"},{"field_type_labels":"Action","hide_in_edit":true,"short_display":true,"hidden_hyperlink":true,"disable_expansion":true,"_ARRAY_META":{"_HASH":"8566600812"},"display_name":"Reject","false_alternate_label_str":"No","true_alternate_label_str":"Yes","action_settings_":{"javascript_code":"tipoHandle.presentTipoForm(\"Reject Reason\", \"RejectReason\",\"create\", { tipo: {}, hide_actions: true }, []).then(function(res){\r\n    if(res.reject_reason){\r\n        console.log('***', res);\r\n//     // Success function\r\n        const domain = window.localStorage.getItem('server_url') ? window.localStorage.getItem('server_url') : window.location.origin +'/';\r\n        const PTW_LINK = domain +'#/tipo/PTW/'+ data_handle.tipo.tipo_id;\r\n        const APP_LINK = domain +'#/login';\r\n        let filter = `(jobRoleCategory.keyword:(Manager) AND (roles.keyword:SiteAdmin))`;\r\n        tipoHandle.getTipos('TipoFIDUser', { tipo_filter: filter }).then((res) => {\r\n            const users = res.count > 0 ? res.map(t => t.email) : [];\r\n            let subject = 'The PTW has been Rejected';\r\n            let body = `<div><b style=\"font-size: 22px;\">Permit to work Details: </b> <br><br><br>\r\n                Permit to Work ID: ${data_handle.tipo.tipo_id} <br>\r\n                Permit Title: ${data_handle.tipo.permit_title} <br> \r\n                Permit to Work Status: ${data_handle.tipo.status_ptw} <br>\r\n                Reject Reason: ${res.reject_reason} <br>\r\n                Description:  The PTW is Rejected and reject reason is ${res.reject_reason} <br><br>\r\n                You can view the PTW details here <a href=\" ${PTW_LINK} \" target=\"_blank\" rel=\"noopener noreferrer\" data-auth=\"NotApplicable\" data-linkindex=\"5\" >here</a> <br><br><br>\r\n                <i>Kind Regards, <br>\r\n                Forwood Safety Team</i>\r\n                </div>`;\r\n            tipoHandle.sendEmail('satest@forwoodsafety.com', subject, body);\r\n            //tipoHandle.sendEmail(users.toString(), subject, body);\r\n\r\n        })\r\n                tipoHandle.showMessage('PTW Rejected', '');\r\n            data_handle.tipo.status_ptw = 'Rejected';\r\n            tipoHandle.updateTipo(data_handle.tipo_name,data_handle.tipo.tipo_id, data_handle.tipo).then((res) => {\r\n                console.log(data_handle)\r\n                })\r\n        }\r\n})\r\n    \r\nreturn true;"},"field_name":"reject_ptw","desktop_width":"30","element_style":"{'margin':'10px'}","visibility_expression":"$tipo.status_ptw === 'Approval Requested' && ($tipo_handle.user_meta.role === 'Manager' || $tipo_handle.user_meta.role === 'TipoUser')","sequence":1,"value_class":"rejectBtn btnStandard","relationship_type":"reference","hide_in_create":true,"show_question_no":true,"element_style_labels":"Margin-10px","hidden_label":true,"field_type":"action"},{"field_type_labels":"Action","hide_in_edit":true,"short_display":true,"hidden_hyperlink":true,"disable_expansion":true,"_ARRAY_META":{"_HASH":"8089858777"},"display_name":"Request Approval","false_alternate_label_str":"No","true_alternate_label_str":"Yes","action_settings_":{"javascript_code":"data_handle.tipo.status_ptw = 'Approval Requested';\r\ntipoHandle.updateTipo(data_handle.tipo_name,data_handle.tipo.tipo_id,data_handle.tipo).then(()=>{\r\n    tipoHandle.showMessage('Approval Requested');\r\n});\r\n\r\n// Notification\r\nconst domain = window.localStorage.getItem('server_url') ? window.localStorage.getItem('server_url') : window.location.origin +'/';\r\nconst PTW_LINK = domain +'#/tipo/PTW/'+ data_handle.tipo.tipo_id;\r\nconst APP_LINK = domain +'#/login';\r\nlet filter = `(jobRoleCategory.keyword:(Manager) AND (roles.keyword:(!SiteAdmin)))`;\r\ntipoHandle.getTipos('TipoFIDUser', { tipo_filter: filter }).then((res) => {\r\n    const users = res.count > 0 ? res.map(t => t.email) : [];\r\n    let subject = 'A PTW has been requested for Approval.';\r\n    let body = `<div><b style=\"font-size: 22px;\">Permit to work Details: </b> <br><br><br>\r\n                Permit to Work ID: ${data_handle.tipo.tipo_id} <br>\r\n                Permit Title: ${data_handle.tipo.permit_title} <br> \r\n                Permit to work Status: ${data_handle.tipo.status_ptw} <br>\r\n                Description: The approval is required for a PTW, Request that you take an investigation and update it. <br><br>\r\n                You can view the PTW details here <a href=\"${PTW_LINK}\" target=\"_blank\" rel=\"noopener noreferrer\" data-auth=\"NotApplicable\" data-linkindex=\"5\" >here</a> <br><br><br>\r\n                <i>Kind Regards, <br>\r\n                Forwood Safety Team</i>\r\n                </div>`;\r\n            tipoHandle.sendEmail('satest@forwoodsafety.com', subject, body);\r\n           // tipoHandle.sendEmail(users.toString(), subject, body);\r\n\r\n        })\r\n\r\nreturn true;"},"field_name":"request_approval_ptw","desktop_width":"30","element_style":"{'margin':'10px'}","visibility_expression":"$tipo.status_ptw === 'Rejected' && ($tipo_handle.user_meta.role === 'ManagerSiteAdmin' || $tipo_handle.user_meta.role === 'TipoUser')","sequence":1,"value_class":"existingPTW btnStandard","relationship_type":"reference","hide_in_create":true,"show_question_no":true,"element_style_labels":"Margin-10px","hidden_label":true,"field_type":"action"},{"field_type_labels":"PermitDetails","short_display":true,"hidden_hyperlink":true,"disable_expansion":false,"_ARRAY_META":{"_HASH":"7586684772"},"display_name":"Permit Details","false_alternate_label_str":"No","true_alternate_label_str":"Yes","field_name":"permit_details","visibility_expression":"$tipo_handle.menu_item.tipo_name === 'PTW'","sequence":2,"hide_header":true,"relationship_type":"reference","do_not_nest_data":true,"show_question_no":true,"field_type":"FieldGroup.PermitDetails"},{"field_type_labels":"parent","short_display":true,"hidden_hyperlink":true,"show_in_wizard":false,"disable_expansion":false,"_ARRAY_META":{"_HASH":"3657222810"},"display_name":"Steps Included","false_alternate_label_str":"No","true_alternate_label_str":"Yes","field_name":"tasks","sequence":3,"hide_header":true,"relationship_type":"reference","show_in_expansion_panel":false,"tipo_array":true,"do_not_nest_data":true,"show_question_no":true,"hidden_label":false,"field_type":"FieldGroup.parent","wizard_direction":"Horizontal"},{"field_type_labels":"Text","short_display":true,"hidden_hyperlink":true,"disable_expansion":true,"_ARRAY_META":{"_HASH":"9208402354"},"display_name":"tipo_filter","false_alternate_label_str":"No","true_alternate_label_str":"Yes","field_name":"tipo_filter","hidden_":true,"sequence":7,"relationship_type":"reference","show_question_no":true,"field_type":"string"}],"___commit_number___":"8aae8667-5252-4613-8bb7-e7f55778bf4c","created_by":"saadmin@forwoodsafety.com","copy_from_tipo_id":"PTW","application":"0443429762","hash_key":"2000000001.0443429762.2000000001.TipoDefinition.PTWCopy","el_index":true,"updated_dt":1718699414478,"updated_by":null,"tipo_name":"TipoDefinition","tipo_id":"PTWCopy","created_date":"2023-05-07T04:36:57.592Z","updated_date":"2024-06-18T08:30:14.478Z","account":"2000000001","tipo_meta":{"tipo_type_copy":"entity","pre_load":false,"grid_max_columns":"10","tipo_type_labels":["Simple Tipo"],"desktop_max_columns":"3","hide_create":true,"tipo_type":["entity"],"tablet_max_columns":"2","tipo_name":"PTWCopy","mobile_max_columns":"1","display_name":"PTWCopy","tipo_type_copy_labels":"Simple Tipo"}}}
